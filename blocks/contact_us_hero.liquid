{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  /* ---- Local design tokens (scoped) ---- */
  .ai-problem-solver-cta-{{ ai_gen_id }}{
    --lg-blur: 18px;
    --lg-saturate: 180%;
    --lg-border: hsla(0,0%,100%,.22);
    --lg-shadow: rgba(0,0,0,.25);

    --btn-radius: {{ block.settings.button_border_radius | default: 12 }}px;
    --btn-py: {{ block.settings.button_padding_y | default: 16 }}px;
    --btn-px: {{ block.settings.button_padding_x | default: 20 }}px;
    --btn-minh: {{ block.settings.button_min_height | default: 52 }}px;
    --btn-border-w: {{ block.settings.button_border_width | default: 2 }}px;
    --btn-text: {{ block.settings.button_text | default: '#FFFFFF' }};
    --btn-tag: {{ block.settings.button_tag_color | default: '#A8B0BB' }};
    --arrow: {{ block.settings.arrow_size | default: 20 }}px;
  }

  {%- assign overlay_alpha = block.settings.overlay_opacity | default: 50 | divided_by: 100.0 -%}

  /* ---------- Wrapper: HEIGHT controlled via Theme Editor ---------- */
  .ai-problem-solver-cta-{{ ai_gen_id }}{
    position:relative;
    display:flex; align-items:center; overflow:hidden; isolation:isolate;
    color: {{ block.settings.text_color | default: '#FFFFFF' }};
    background-color: {{ block.settings.background_color | default: '#0E1116' }};
    padding: {{ block.settings.section_padding_mobile | default: 60 }}px 20px;

    /* Desktop height (px) like your Video Hero */
    min-height: {{ block.settings.section_height | default: 600 }}px;
    {% if block.settings.background_image %}
      background-image:url('{{ block.settings.background_image | image_url: width: 1920 }}');
      background-size:cover; background-position:center; background-repeat:no-repeat;
    {% endif %}
  }

  /* PSEUDO OVERLAY â€” above image, below content; uses Liquid alpha so the slider reflects live */
  {% if block.settings.background_image and block.settings.overlay_enable %}
  .ai-problem-solver-cta-{{ ai_gen_id }}::before{
    content:""; position:absolute; inset:0; pointer-events:none; z-index:1;
    background: {{ block.settings.overlay_color | default: '#000000' | color_modify: 'alpha', overlay_alpha }};
    background: rgba(
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'red' }},
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'green' }},
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'blue' }},
      {{ overlay_alpha }}
    );
  }
  {% endif %}

  .ai-problem-solver-cta__container-{{ ai_gen_id }}{ max-width: {{ block.settings.max_width | default: 1200 }}px; margin:0 auto; width:100%; position:relative; z-index:2; }
  .ai-problem-solver-cta__content-{{ ai_gen_id }}{ text-align:center; }

  .ai-problem-solver-cta__heading-{{ ai_gen_id }}{
    color: {{ block.settings.heading_color | default: '#FFFFFF' }};
    font-size: {{ block.settings.heading_size_mobile | default: 32 }}px;
    font-weight: {{ block.settings.heading_weight | default: '700' }};
    line-height: {{ block.settings.heading_line_height | default: 1.2 }};
    margin:0 0 {{ block.settings.heading_margin_bottom | default: 16 }}px;
  }
  .ai-problem-solver-cta__subheading-{{ ai_gen_id }}{
    color: {{ block.settings.subheading_color | default: '#A8B0BB' }};
    font-size: {{ block.settings.subheading_size_mobile | default: 18 }}px;
    line-height: {{ block.settings.subheading_line_height | default: 1.4 }};
    font-weight: {{ block.settings.subheading_weight | default: '400' }};
    margin:0 0 {{ block.settings.subheading_margin_bottom | default: 40 }}px;
  }

  .ai-problem-solver-cta__buttons-{{ ai_gen_id }}{
    display:flex; flex-direction:column; gap: {{ block.settings.button_gap | default: 20 }}px;
    max-width: {{ block.settings.buttons_max_width | default: 360 }}px; margin:0 auto;
  }

  /* ---------- DARK GLASS BUTTON (scheme-proof) ---------- */
  .ai-problem-solver-cta__button-{{ ai_gen_id }}{
    width:100%; display:inline-flex; align-items:center; justify-content:space-between; gap:12px;
    text-decoration:none; white-space:normal; color: var(--btn-text) !important;

    min-height: var(--btn-minh);
    padding: var(--btn-py) var(--btn-px);
    border-radius: var(--btn-radius);
    border: var(--btn-border-w) solid var(--lg-border) !important;

    background: linear-gradient(0deg, rgba(255,255,255,.18), rgba(255,255,255,.18)) !important;
    backdrop-filter: saturate(var(--lg-saturate)) blur(var(--lg-blur)) !important;
    -webkit-backdrop-filter: saturate(var(--lg-saturate)) blur(var(--lg-blur)) !important;
    box-shadow: 0 6px 18px var(--lg-shadow), inset 0 1px 0 rgba(255,255,255,.12) !important;

    font-weight: {{ block.settings.button_font_weight | default: '600' }};
    font-size: {{ block.settings.button_font_size | default: 16 }}px;
    letter-spacing:-.01em; transition:transform .2s ease, box-shadow .2s ease, background .2s ease;
  }
  .ai-problem-solver-cta__button-{{ ai_gen_id }}:hover{
    transform:translateY(-{{ block.settings.hover_lift | default: 2 }}px);
    background: linear-gradient(0deg, rgba(255,255,255,.24), rgba(255,255,255,.24)) !important;
    box-shadow: 0 {{ block.settings.hover_shadow_y | default: 8 }}px {{ block.settings.hover_shadow_blur | default: 25 }}px {{ block.settings.hover_shadow_color | default: 'rgba(0,0,0,0.3)' }}, inset 0 1px 0 rgba(255,255,255,.14) !important;
  }

  .ai-problem-solver-cta__button-content-{{ ai_gen_id }}{ display:flex; flex-direction:column; align-items:flex-start; flex-grow:1; min-width:0; }
  .ai-problem-solver-cta__button-label-{{ ai_gen_id }}{ font-weight: inherit; font-size: inherit; margin-bottom:2px; }
  .ai-problem-solver-cta__button-tag-{{ ai_gen_id }}{ font-size: {{ block.settings.button_tag_size | default: 12 }}px; color: var(--btn-tag); font-weight: {{ block.settings.button_tag_weight | default: '400' }}; }
  .ai-problem-solver-cta__button-arrow-{{ ai_gen_id }}{ width: var(--arrow); height: var(--arrow); flex-shrink:0; color: currentColor; }

  /* ---------- Mobile height control ---------- */
  @media (max-width:768px){
    .ai-problem-solver-cta-{{ ai_gen_id }}{
      padding: {{ block.settings.section_padding_mobile | default: 60 }}px 20px;
      min-height: {{ block.settings.section_height_mobile | default: 500 }}px;
    }
  }

  /* ---------- Desktop tweaks ---------- */
  @media (min-width:768px){
    .ai-problem-solver-cta-{{ ai_gen_id }}{
      padding: {{ block.settings.section_padding_desktop | default: 80 }}px 20px;
    }
    .ai-problem-solver-cta__content-{{ ai_gen_id }}{
      text-align: {{ block.settings.text_alignment_desktop | default: 'center' }};
    }
    .ai-problem-solver-cta__buttons-{{ ai_gen_id }}{
      {% if block.settings.text_alignment_desktop == 'left' %} margin:0;
      {% elsif block.settings.text_alignment_desktop == 'right' %} margin:0 0 0 auto;
      {% else %} margin:0 auto; {% endif %}
    }
    .ai-problem-solver-cta__heading-{{ ai_gen_id }}{ font-size: {{ block.settings.heading_size_desktop | default: 48 }}px; }
    .ai-problem-solver-cta__subheading-{{ ai_gen_id }}{ font-size: {{ block.settings.subheading_size_desktop | default: 20 }}px; }
  }
{% endstyle %}

<div class="ai-problem-solver-cta-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-problem-solver-cta__container-{{ ai_gen_id }}">
    <div class="ai-problem-solver-cta__content-{{ ai_gen_id }}">
      {% if block.settings.heading != blank %}
        <h2 class="ai-problem-solver-cta__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      {% endif %}
      {% if block.settings.subheading != blank %}
        <p class="ai-problem-solver-cta__subheading-{{ ai_gen_id }}">{{ block.settings.subheading }}</p>
      {% endif %}

      <div class="ai-problem-solver-cta__buttons-{{ ai_gen_id }}">
        {% for i in (1..5) %}
          {% assign lbl = 'cta_' | append: i | append: '_label' %}
          {% assign lnk = 'cta_' | append: i | append: '_link' %}
          {% assign tag = 'cta_' | append: i | append: '_tag' %}
          {% if block.settings[lbl] != blank %}
            <a href="{{ block.settings[lnk] | default: '#' }}" class="ai-problem-solver-cta__button-{{ ai_gen_id }}">
              <div class="ai-problem-solver-cta__button-content-{{ ai_gen_id }}">
                <span class="ai-problem-solver-cta__button-label-{{ ai_gen_id }}">{{ block.settings[lbl] }}</span>
                {% if block.settings[tag] != blank %}
                  <span class="ai-problem-solver-cta__button-tag-{{ ai_gen_id }}">{{ block.settings[tag] }}</span>
                {% endif %}
              </div>
              <svg class="ai-problem-solver-cta__button-arrow-{{ ai_gen_id }}" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Problem solver CTA",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "We want your problems solved more than you do" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "What can we do for you?" },

    { "type": "header", "content": "Background & Layout" },
    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "color", "id": "background_color", "label": "Background color", "default": "#0E1116" },
    { "type": "checkbox", "id": "overlay_enable", "label": "Enable overlay", "default": false },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 5, "unit": "%", "default": 50 },

    { "type": "range", "id": "max_width", "label": "Max content width", "min": 800, "max": 1400, "step": 50, "unit": "px", "default": 1200 },
    { "type": "select", "id": "text_alignment_desktop", "label": "Desktop text alignment", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ], "default": "center" },

    { "type": "header", "content": "Section Spacing & HEIGHT (px)" },
    { "type": "range", "id": "section_height", "label": "Banner height (desktop, px)", "min": 200, "max": 1200, "step": 20, "unit": "px", "default": 700 },
    { "type": "range", "id": "section_height_mobile", "label": "Banner height (mobile, px)", "min": 200, "max": 900, "step": 20, "unit": "px", "default": 560 },
    { "type": "range", "id": "section_padding_mobile", "label": "Mobile padding", "min": 20, "max": 120, "step": 10, "unit": "px", "default": 60 },
    { "type": "range", "id": "section_padding_desktop", "label": "Desktop padding", "min": 40, "max": 200, "step": 10, "unit": "px", "default": 80 },

    { "type": "header", "content": "Typography" },
    { "type": "color", "id": "text_color", "label": "Default text color", "default": "#FFFFFF" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#FFFFFF" },
    { "type": "range", "id": "heading_size_mobile", "label": "Mobile heading size", "min": 24, "max": 60, "step": 2, "unit": "px", "default": 32 },
    { "type": "range", "id": "heading_size_desktop", "label": "Desktop heading size", "min": 32, "max": 80, "step": 2, "unit": "px", "default": 48 },
    { "type": "select", "id": "heading_weight", "label": "Heading weight", "options": [
      {"value": "400", "label": "Normal"}, {"value": "500", "label": "Medium"}, {"value": "600", "label": "Semi Bold"}, {"value": "700", "label": "Bold"}, {"value": "800", "label": "Extra Bold"}
    ], "default": "700" },
    { "type": "range", "id": "heading_line_height", "label": "Heading line height", "min": 1.0, "max": 2.0, "step": 0.1, "default": 1.2 },
    { "type": "range", "id": "heading_margin_bottom", "label": "Heading bottom margin", "min": 8, "max": 40, "step": 2, "unit": "px", "default": 16 },
    { "type": "color", "id": "subheading_color", "label": "Subheading color", "default": "#A8B0BB" },
    { "type": "range", "id": "subheading_size_mobile", "label": "Mobile subheading size", "min": 14, "max": 28, "step": 1, "unit": "px", "default": 18 },
    { "type": "range", "id": "subheading_size_desktop", "label": "Desktop subheading size", "min": 16, "max": 32, "step": 1, "unit": "px", "default": 20 },
    { "type": "select", "id": "subheading_weight", "label": "Subheading weight", "options": [
      {"value": "300", "label": "Light"}, {"value": "400", "label": "Normal"}, {"value": "500", "label": "Medium"}, {"value": "600", "label": "Semi Bold"}
    ], "default": "400" },
    { "type": "range", "id": "subheading_line_height", "label": "Subheading line height", "min": 1.2, "max": 2.0, "step": 0.1, "default": 1.4 },
    { "type": "range", "id": "subheading_margin_bottom", "label": "Subheading bottom margin", "min": 20, "max": 80, "step": 5, "unit": "px", "default": 40 },

    { "type": "header", "content": "Button Styling" },
    { "type": "range", "id": "buttons_max_width", "label": "Buttons max width", "min": 280, "max": 500, "step": 20, "unit": "px", "default": 360 },
    { "type": "range", "id": "button_gap", "label": "Gap between buttons", "min": 10, "max": 40, "step": 2, "unit": "px", "default": 20 },
    { "type": "range", "id": "button_padding_y", "label": "Button vertical padding", "min": 12, "max": 32, "step": 2, "unit": "px", "default": 16 },
    { "type": "range", "id": "button_padding_x", "label": "Button horizontal padding", "min": 16, "max": 40, "step": 2, "unit": "px", "default": 20 },
    { "type": "range", "id": "button_border_radius", "label": "Button border radius", "min": 4, "max": 50, "step": 2, "unit": "px", "default": 12 },
    { "type": "range", "id": "button_border_width", "label": "Button border width", "min": 1, "max": 4, "step": 1, "unit": "px", "default": 2 },
    { "type": "range", "id": "button_min_height", "label": "Button minimum height", "min": 50, "max": 80, "step": 2, "unit": "px", "default": 52 },
    { "type": "range", "id": "button_font_size", "label": "Button font size", "min": 14, "max": 20, "step": 1, "unit": "px", "default": 16 },
    { "type": "select", "id": "button_font_weight", "label": "Button font weight", "options": [
      {"value": "400", "label": "Normal"}, {"value": "500", "label": "Medium"}, {"value": "600", "label": "Semi Bold"}, {"value": "700", "label": "Bold"}
    ], "default": "600" },
    { "type": "range", "id": "button_tag_size", "label": "Button tag font size", "min": 10, "max": 16, "step": 1, "unit": "px", "default": 12 },
    { "type": "color", "id": "button_tag_color", "label": "Button tag color", "default": "#A8B0BB" },
    { "type": "select", "id": "button_tag_weight", "label": "Button tag weight", "options": [
      {"value": "300", "label": "Light"}, {"value": "400", "label": "Normal"}, {"value": "500", "label": "Medium"}
    ], "default": "400" },
    { "type": "range", "id": "arrow_size", "label": "Arrow icon size", "min": 16, "max": 28, "step": 2, "unit": "px", "default": 20 },

    { "type": "header", "content": "CTA Buttons" },
    { "type": "text", "id": "cta_1_label", "label": "Button 1 label", "default": "Schedule Consultation" },
    { "type": "url", "id": "cta_1_link", "label": "Button 1 link" },
    { "type": "text", "id": "cta_1_tag", "label": "Button 1 tag", "default": "Free 30-minute call" },

    { "type": "text", "id": "cta_2_label", "label": "Button 2 label", "default": "Get Support" },
    { "type": "url", "id": "cta_2_link", "label": "Button 2 link" },
    { "type": "text", "id": "cta_2_tag", "label": "Button 2 tag", "default": "24/7 technical help" },

    { "type": "text", "id": "cta_3_label", "label": "Button 3 label", "default": "Request Quote" },
    { "type": "url", "id": "cta_3_link", "label": "Button 3 link" },
    { "type": "text", "id": "cta_3_tag", "label": "Button 3 tag", "default": "Custom pricing available" },

    { "type": "text", "id": "cta_4_label", "label": "Button 4 label", "default": "Book Installation" },
    { "type": "url", "id": "cta_4_link", "label": "Button 4 link" },
    { "type": "text", "id": "cta_4_tag", "label": "Button 4 tag", "default": "Professional setup" },

    { "type": "text", "id": "cta_5_label", "label": "Button 5 label", "default": "Maintenance Plans" },
    { "type": "url", "id": "cta_5_link", "label": "Button 5 link" },
    { "type": "text", "id": "cta_5_tag", "label": "Button 5 tag", "default": "Ongoing care packages" }
  ],
  "presets": [{ "name": "Problem solver CTA" }]
}
{% endschema %}
