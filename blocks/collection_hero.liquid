{% comment %}
  Video Hero Banner Section with URL input
  - Overlay via wrapper ::before (above video, below content)
  - Legacy overlay <div> kept but hidden
  - NEW: size controls (desktop & mobile) for headline/subtitle, line-heights, content max-width, button text size & radius
{% endcomment %}

{% assign ai_gen_id = block.id | replace: '_' | downcase %}

{% style %}
  .video-hero-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: {{ block.settings.section_height }}vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
  }

  .video-hero__background-{{ ai_gen_id }} {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  .video-hero__video-{{ ai_gen_id }},
  .video-hero__fallback-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-hero__placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #1a1a1a;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .video-hero__placeholder-{{ ai_gen_id }} svg {
    width: 200px;
    height: 200px;
    opacity: 0.3;
  }

  {%- assign overlay_alpha = block.settings.overlay_opacity | default: 40 | divided_by: 100.0 -%}

  /* Pseudo overlay — above video, below content */
  .video-hero-{{ ai_gen_id }}::before {
    content: "";
    position: absolute; inset: 0; pointer-events: none;
    z-index: 2;
    /* Fallback */
    background: rgba(
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'red' }},
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'green' }},
      {{ block.settings.overlay_color | default: '#000000' | color_extract: 'blue' }},
      {{ overlay_alpha }}
    );
    /* Preferred */
    background: {{ block.settings.overlay_color | default: '#000000' | color_modify: 'alpha', overlay_alpha }};
  }

  /* Hide legacy overlay <div> so we don't double-dim */
  .video-hero__overlay-{{ ai_gen_id }} { display: none !important; }

  .video-hero__content-{{ ai_gen_id }} {
    position: relative;
    z-index: 3;
    text-align: center;
    color: {{ block.settings.headline_color | default: '#ffffff' }};
    padding: 0 20px;
    width: 100%;
    max-width: var(--vh-content-max, 800px);
    margin-left: auto;
    margin-right: auto;
  }

  .video-hero__headline-{{ ai_gen_id }} {
    /* Use CSS vars (set inline on wrapper) so editor changes reflect instantly */
    font-size: clamp(var(--vh-h-mobile, 28px), 4vw, var(--vh-h-desktop, 56px));
    line-height: var(--vh-h-lh-desktop, 1.1);
    font-weight: 700;
    margin: 0 0 var(--vh-h-mb, 12px);
    letter-spacing: var(--vh-h-ls, -0.02em);
    color: {{ block.settings.headline_color | default: '#ffffff' }};
  }

  .video-hero__subtitle-{{ ai_gen_id }} {
    font-size: clamp(var(--vh-sub-mobile, 14px), 2.5vw, var(--vh-sub-desktop, 20px));
    line-height: var(--vh-sub-lh, 1.4);
    font-weight: 400;
    margin: 0 0 var(--vh-sub-mb, 24px);
    opacity: 0.9;
    color: {{ block.settings.subtitle_color | default: '#ffffff' }};
  }

  .video-hero__buttons-{{ ai_gen_id }} {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  .video-hero__button-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.75rem;
    font-size: var(--vh-btn-text, 14px);
    font-weight: 600;
    text-decoration: none;
    border-radius: var(--vh-btn-radius, 50px);
    transition: transform .3s ease, background-color .2s ease, border-color .2s ease, color .2s ease;
    min-width: 120px;
    border: 2px solid transparent;
  }

  .video-hero__button-{{ ai_gen_id }}:focus {
    outline: 2px solid white;
    outline-offset: 2px;
  }

  .video-hero__button--primary-{{ ai_gen_id }} {
    background-color: {{ block.settings.primary_button_color | default: '#ffffff' }};
    color: {{ block.settings.primary_button_text_color | default: '#000000' }};
    border-color: {{ block.settings.primary_button_color | default: '#ffffff' }};
  }

  .video-hero__button--primary-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.primary_button_hover_color | default: '#f0f0f0' }};
    border-color: {{ block.settings.primary_button_hover_color | default: '#f0f0f0' }};
    transform: translateY(-2px);
  }

  .video-hero__button--secondary-{{ ai_gen_id }} {
    background-color: transparent;
    color: {{ block.settings.secondary_button_text_color | default: '#ffffff' }};
    border-color: {{ block.settings.secondary_button_border_color | default: '#ffffff' }};
  }

  .video-hero__button--secondary-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.secondary_button_hover_bg | default: '#ffffff' }};
    color: {{ block.settings.secondary_button_hover_text | default: '#000000' }};
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .video-hero-{{ ai_gen_id }} {
      height: {{ block.settings.section_height | times: 0.8 }}vh;
    }
    .video-hero__buttons-{{ ai_gen_id }} {
      flex-direction: column;
      align-items: center;
    }
    .video-hero__button-{{ ai_gen_id }} {
      width: 100%;
      max-width: 250px;
    }
    .video-hero__headline-{{ ai_gen_id }} {
      line-height: var(--vh-h-lh-mobile, 1.2);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .video-hero__video-{{ ai_gen_id }} { display: none; }
  }
{% endstyle %}

<div
  class="video-hero-{{ ai_gen_id }}"
  style="
    --vh-h-desktop: {{ block.settings.headline_size_desktop }}px;
    --vh-h-mobile: {{ block.settings.headline_size_mobile }}px;
    --vh-h-lh-desktop: {{ block.settings.headline_line_height_desktop }};
    --vh-h-lh-mobile: {{ block.settings.headline_line_height_mobile }};
    --vh-h-mb: {{ block.settings.headline_spacing_bottom }}px;
    --vh-h-ls: {{ block.settings.headline_letter_spacing }}em;
    --vh-sub-desktop: {{ block.settings.subtitle_size_desktop }}px;
    --vh-sub-mobile: {{ block.settings.subtitle_size_mobile }}px;
    --vh-sub-lh: {{ block.settings.subtitle_line_height }};
    --vh-sub-mb: {{ block.settings.subtitle_spacing_bottom }}px;
    --vh-content-max: {{ block.settings.content_max_width }}px;
    --vh-btn-text: {{ block.settings.button_text_size }}px;
    --vh-btn-radius: {{ block.settings.button_radius }}px;
  "
  {{ block.shopify_attributes }}
>
  <div class="video-hero__background-{{ ai_gen_id }}">
    {% if block.settings.background_video != blank %}
      <video
        class="video-hero__video-{{ ai_gen_id }}"
        autoplay
        muted
        loop
        playsinline
        aria-hidden="true"
        preload="metadata"
      >
        <source src="{{ block.settings.background_video }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    {% endif %}

    {% if block.settings.fallback_image %}
      <img
        src="{{ block.settings.fallback_image | image_url: width: 2000 }}"
        alt=""
        class="video-hero__fallback-image-{{ ai_gen_id }}"
        loading="lazy"
        width="{{ block.settings.fallback_image.width }}"
        height="{{ block.settings.fallback_image.height }}"
      >
    {% elsif block.settings.background_video == blank %}
      <div class="video-hero__placeholder-{{ ai_gen_id }}">
        {{ 'hero-apparel-1' | placeholder_svg_tag }}
      </div>
    {% endif %}
  </div>

  <!-- Legacy overlay kept for compatibility; hidden via CSS -->
  <div class="video-hero__overlay-{{ ai_gen_id }}"></div>

  <div class="video-hero__content-{{ ai_gen_id }}">
    {% if block.settings.headline_line_1 or block.settings.headline_line_2 %}
      <h1 class="video-hero__headline-{{ ai_gen_id }}">
        {% if block.settings.headline_line_1 %}
          {{ block.settings.headline_line_1 }}<br>
        {% endif %}
        {% if block.settings.headline_line_2 %}
          {{ block.settings.headline_line_2 }}
        {% endif %}
      </h1>
    {% endif %}

    {% if block.settings.subtitle %}
      <p class="video-hero__subtitle-{{ ai_gen_id }}">
        {{ block.settings.subtitle }}
      </p>
    {% endif %}

    <div class="video-hero__buttons-{{ ai_gen_id }}">
      {% if block.settings.primary_button_label and block.settings.primary_button_link %}
        <a
          href="{{ block.settings.primary_button_link }}"
          class="video-hero__button-{{ ai_gen_id }} video-hero__button--primary-{{ ai_gen_id }}"
        >
          {{ block.settings.primary_button_label }}
        </a>
      {% endif %}

      {% if block.settings.secondary_button_label and block.settings.secondary_button_link %}
        <a
          href="{{ block.settings.secondary_button_link }}"
          class="video-hero__button-{{ ai_gen_id }} video-hero__button--secondary-{{ ai_gen_id }}"
        >
          {{ block.settings.secondary_button_label }}
        </a>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  const video = document.querySelector('.video-hero__video-{{ ai_gen_id }}');
  if (!video) return;
  const tryPlay = () => video.play().catch(err => console.log('Video autoplay failed:', err));
  if (video.readyState >= 3) tryPlay();
  video.addEventListener('loadeddata', tryPlay);
})();
</script>

{% schema %}
{
  "name": "Video Hero Banner",
  "settings": [
    { "type": "header", "content": "Banner Size" },
    {
      "type": "range",
      "id": "section_height",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "label": "Banner Height",
      "default": 60,
      "info": "Adjust banner height as percentage of viewport"
    },

    { "type": "header", "content": "Background" },
    {
      "type": "url",
      "id": "background_video",
      "label": "Background video URL",
      "info": "Upload to Settings → Files, then paste the URL here"
    },
    {
      "type": "image_picker",
      "id": "fallback_image",
      "label": "Fallback image",
      "info": "Shown when video is unavailable or user prefers reduced motion"
    },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 40
    },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "headline_line_1", "label": "Headline line 1", "default": "Ditch the Keys" },
    { "type": "text", "id": "headline_line_2", "label": "Headline line 2", "default": "Upgrade to Stylish Smart Locks Today" },
    { "type": "textarea", "id": "subtitle", "label": "Subtitle", "default": "Experience the future of home security with our premium smart lock collection" },
    { "type": "color", "id": "headline_color", "label": "Headline color", "default": "#ffffff" },
    { "type": "color", "id": "subtitle_color", "label": "Subtitle color", "default": "#ffffff" },

    { "type": "header", "content": "Typography — Headline" },
    {
      "type": "range",
      "id": "headline_size_desktop",
      "min": 24, "max": 96, "step": 2, "unit": "px",
      "label": "Headline size (desktop)",
      "default": 56
    },
    {
      "type": "range",
      "id": "headline_size_mobile",
      "min": 18, "max": 48, "step": 1, "unit": "px",
      "label": "Headline size (mobile)",
      "default": 28
    },
    {
      "type": "range",
      "id": "headline_line_height_desktop",
      "min": 1.0, "max": 1.6, "step": 0.1,
      "label": "Headline line-height (desktop)",
      "default": 1.1
    },
    {
      "type": "range",
      "id": "headline_line_height_mobile",
      "min": 1.0, "max": 1.8, "step": 0.1,
      "label": "Headline line-height (mobile)",
      "default": 1.2
    },
    {
      "type": "range",
      "id": "headline_letter_spacing",
      "min": -0.1, "max": 0.2, "step": 0.1,
      "label": "Headline letter-spacing (em)",
      "default": 0
    },
    {
      "type": "range",
      "id": "headline_spacing_bottom",
      "min": 0, "max": 48, "step": 2, "unit": "px",
      "label": "Space below headline",
      "default": 12
    },

    { "type": "header", "content": "Typography — Subtitle" },
    {
      "type": "range",
      "id": "subtitle_size_desktop",
      "min": 12, "max": 28, "step": 1, "unit": "px",
      "label": "Subtitle size (desktop)",
      "default": 20
    },
    {
      "type": "range",
      "id": "subtitle_size_mobile",
      "min": 10, "max": 22, "step": 1, "unit": "px",
      "label": "Subtitle size (mobile)",
      "default": 14
    },
    {
      "type": "range",
      "id": "subtitle_line_height",
      "min": 1.0, "max": 2.0, "step": 0.1,
      "label": "Subtitle line-height",
      "default": 1.4
    },
    {
      "type": "range",
      "id": "subtitle_spacing_bottom",
      "min": 0, "max": 64, "step": 2, "unit": "px",
      "label": "Space below subtitle",
      "default": 24
    },

    { "type": "header", "content": "Layout" },
    {
      "type": "range",
      "id": "content_max_width",
      "min": 480, "max": 1200, "step": 20, "unit": "px",
      "label": "Content max width",
      "default": 800
    },

    { "type": "header", "content": "Buttons" },
    {
      "type": "range",
      "id": "button_text_size",
      "min": 10, "max": 20, "step": 1, "unit": "px",
      "label": "Button text size",
      "default": 14
    },
    {
      "type": "range",
      "id": "button_radius",
      "min": 4, "max": 64, "step": 2, "unit": "px",
      "label": "Button corner radius",
      "default": 50
    },

    { "type": "header", "content": "Primary button" },
    { "type": "text", "id": "primary_button_label", "label": "Button label", "default": "Shop Now" },
    { "type": "url", "id": "primary_button_link", "label": "Button link" },
    { "type": "color", "id": "primary_button_color", "label": "Button color", "default": "#ffffff" },
    { "type": "color", "id": "primary_button_text_color", "label": "Button text color", "default": "#000000" },
    { "type": "color", "id": "primary_button_hover_color", "label": "Button hover color", "default": "#f0f0f0" },

    { "type": "header", "content": "Secondary button" },
    { "type": "text", "id": "secondary_button_label", "label": "Button label", "default": "Learn More" },
    { "type": "url", "id": "secondary_button_link", "label": "Button link" },
    { "type": "color", "id": "secondary_button_text_color", "label": "Button text color", "default": "#ffffff" },
    { "type": "color", "id": "secondary_button_border_color", "label": "Button border color", "default": "#ffffff" },
    { "type": "color", "id": "secondary_button_hover_bg", "label": "Button hover background", "default": "#ffffff" },
    { "type": "color", "id": "secondary_button_hover_text", "label": "Button hover text color", "default": "#000000" }
  ],
  "presets": [{ "name": "Video Hero Banner" }]
}
{% endschema %}
