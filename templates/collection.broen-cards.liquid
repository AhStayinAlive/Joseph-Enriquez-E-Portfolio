{%- comment -%}
  View: broen-cards
  Purpose: Return only the cards markup (server-side paginated) for the current collection.
  Query params:
    - page: standard Shopify paginate page number
    - door_type: optional filter slug to match server/client
    - gid: optional class/id suffix to match the calling block's ai_gen_id
{%- endcomment -%}

{%- assign gid = request.query_parameters.gid | default: 'cards' -%}
{%- assign current_filter = request.query_parameters.door_type | default: '' -%}
{%- paginate collection.products by 250 -%}
  {%- for product in collection.products -%}
    {%- assign door_mf = product.metafields.custom.door_type -%}
    {%- if door_mf == blank -%}{%- assign door_mf = product.metafields['custom']['door_type'] -%}{%- endif -%}
    {%- if door_mf == blank -%}{%- assign door_type_raw = '' -%}{%- else -%}
      {%- if door_mf.value != blank -%}{%- assign door_type_raw = door_mf.value -%}{%- else -%}{%- assign door_type_raw = door_mf -%}{%- endif -%}
    {%- endif -%}
    {%- assign door_type_slug = door_type_raw | default: 'unassigned' | handleize -%}
    {%- if current_filter != '' and current_filter != door_type_slug -%}{% continue %}{%- endif -%}

    {%- render 'broen-card', product: product, ai_gen_id: gid, title_truncate: 50, classification_placeholder_text: 'Premium Lock' -%}
  {%- endfor -%}
{%- endpaginate -%}

